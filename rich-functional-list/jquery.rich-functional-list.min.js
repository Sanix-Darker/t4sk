!function(){"use strict";function a(){$("."+g.triggerClass).off("click",b).on("click",b)}function b(){$(this).toggleClass(g.triggerRotClass)}function c(){$("."+g.titleContentClass+", ."+g.itemContentClass).click(function(){var a,b=$(this).text();$(this).off(),$(this).html(""),$("<textarea></textarea>").attr({"class":"textbox",cols:40,rows:3}).appendTo(this).focus().html(b).focusout(function(){a=$(this).val(),$(this).parent().html(a),$(this).remove()}),$(this).focusout(function(){c(),g.domUpdate.call(this)}),g.stateUpdate()})}function d(a){var b=a.originalEvent.touches?a.originalEvent.touches[0]:a;k.floating&&(a.preventDefault(),a.data.dragMove(b,a.data.list))}function e(a){var b=a.originalEvent.touches?a.originalEvent.touches[0]:a;k.floating&&(a.preventDefault(),a.data.dragStop(b,a.data.list,$(a.data)))}function f(a,b){if(a){var c=b.parents("."+g.titleItemClass).length?b.parents("."+g.titleItemClass).parent("."+g.listTitle):b.parents("."+g.itemClass);saveState.listsChanged=!0,1===c.parent("."+g.mainAccordionClass).children("."+g.itemClass).length?(c.parent("."+g.mainAccordionClass).prev("."+g.titleItemClass).children().remove("."+g.triggerClass),c.parent("."+g.mainAccordionClass).remove()):1===c.parent("."+g.subAccordionClass).children("."+g.itemClass).length&&(c.parent("."+g.subAccordionClass).parent("."+g.subItemClass).prev("."+g.listTitle).children().remove("."+g.triggerClass),c.parent("."+g.subAccordionClass).parent("."+g.subItemClass).prev("."+g.listTitle).removeClass(g.listTitle),c.parent("."+g.subAccordionClass).parent("."+g.subItemClass).remove(),c.parent("."+g.subAccordionClass).remove()),c.next("."+g.subItemClass).children(g.listNode).find("*").remove(),c.next("."+g.subItemClass).children(g.listNode).remove(),c.next("."+g.subItemClass).remove(),c.find("*").remove(),c.remove()}}var g,h,i={listNode:"ul",itemNode:"li",listClass:"rfl-list",listTitle:"rfl-list-title",itemContentClass:"rfl-list-content",itemClass:"rfl-item",subItemClass:"rfl-subaccordion-item",titleContentClass:"rfl-title-content",titleItemClass:"rfl-title-card",triggerClass:"rfl-trigger",triggerItemClass:"rfl-trigger-item",triggerMainClass:"rfl-trigger-main",triggerRotClass:"",dragClass:"rfl-dragel",placeClass:"rfl-placeholder",openClass:"rfl-open",deleteClass:"rfl-delete",addClass:"rfl-add",addTitleClass:"rfl-add-title",handleClass:"rfl-handle",mainAccordionClass:"rfl-mainAccordion",subAccordionClass:"rfl-subAccordion",stateUpdate:function(){},domUpdate:function(){},removeMainList:function(){},newItemMarkup:"",openTriggerMarkup:"",subListMarkup:"",subListMarkupMain:"",mainTriggerMarkup:""},j={lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},k={floating:null,evTarget:null,underMouse:null,placeholder:null},l={amount:0,increase:function(){this.amount++}};$.fn.richFunctionalList=function(a){return h=this,g=$.extend({},i,a),k.placeholder=$('<div class="'+g.placeClass+'"></div>'),h.children().each(function(){$(this).addNextList()}),h.rflListeners($(this)),console.log(h.data()),this},$.fn.addNextList=function(){var a="list"+l.amount;h.data(a,new $.RichList(this,a)),l.increase()},$.fn.addNewList=function(){var a="list"+l.amount;this.data(a,new $.RichList(this.children(g.itemNode+":last"),a)),l.increase()},$.fn.rflListeners=function(b){a(),c()},$.fn.delAllEmptyListsTrigs=function(){$.each(this.data(),function(){if(this instanceof $.RichList){var a=$(this.list.$rootList[0]).children("."+g.mainAccordionClass);this.deleteEmptyListsTriggers(a)}})},$.fn.getNumberLists=function(){return l.amount},$.fn.animLocalArrows=function(){this.each(function(){$(this).on("click",function(){$(this).toggleClass("fa-rotate-90")})})},$.fn.expand=function(a){var b=$(this).closest("."+g.itemClass),c=b.next("."+g.subItemClass).children("."+g.subAccordionClass);return a?(c.show(),g.domUpdate.call(this)):void(c.hasClass(g.openClass)||$(this).doExpand(c))},$.fn.collapse=function(a){var b=$(this).closest("."+g.itemClass),c=b.next("."+g.subItemClass).children("."+g.subAccordionClass);return a?(c.hide(),g.domUpdate.call(this)):void(c.hasClass(g.openClass)&&$(this).doCollapse(c))},$.fn.doExpand=function(a){a.addClass(g.openClass),a.slideDown({duration:350,queue:!1,progress:function(){g.domUpdate.call(this)}})},$.fn.doCollapse=function(a){a.slideUp({duration:350,queue:!1,progress:function(){g.domUpdate.call(this)}}),a.removeClass(g.openClass)},$.fn.expandTitle=function(a){var b=$(this).closest("."+g.triggerItemClass),c=b.children("."+g.subAccordionClass);return a?(c.show(),g.domUpdate.call(this)):void(c.hasClass(g.openClass)||(c.addClass(g.openClass),$(this).doExpand(c)))},$.RichList=function(a,b){this.list={$rootList:$(a),listName:b,$triggers:$(a).find("."+g.triggerClass)},this.initFirstTrigger(),this.initInnerTriggers(),this.handleListeners(),this.addItemListener(),this.deleteItemListener()},$.RichList.prototype.newListListeners=function(a,b,c){c.parents().each(function(){if(b!==a){var c=h.data("list"+b),d=$(c.list.$rootList[0]).children("."+g.mainAccordionClass);c.deleteEmptyListsTriggers(d),c.list.$triggers=c.list.$rootList.find("."+g.triggerClass),c.resetItems(),c.resetMouse(),c.list.$triggers.off(),c.initInnerTriggers(),c.initFirstTrigger(),c.list.$triggers.animLocalArrows(),c.handleListeners()}})},$.RichList.prototype.handleListeners=function(){var a=this;a.list.$rootList.find("."+g.handleClass).off(),$(document).off("touchmove mousemove",d),$(document).off("touchend touchcancel mouseup",e),this.list.$rootList.find("."+g.handleClass).on("touchstart mousedown",function(b){var c=b.originalEvent.touches?b.originalEvent.touches[0]:b;b.preventDefault(),a.dragStart(c,a.list),$(document).on("touchmove mousemove",a,d).on("touchend touchcancel mouseup",a,e)})},$.RichList.prototype.addItemListener=function(){var a=this;this.list.$rootList.find("."+g.addClass).unbind().click(function(){saveState.listsChanged=!0;var b=$(this).parents("."+g.itemClass),c=b.next("."+g.subItemClass).children(g.listNode);a.addItem(b,c,!1)}),this.list.$rootList.find("."+g.addTitleClass).unbind().click(function(){saveState.listsChanged=!0;var b=$(this).parents("."+g.triggerItemClass),c=b.children(g.listNode);a.addItem(b,c,!0)})},$.RichList.prototype.deleteItemListener=function(){this.deleteMainList(),this.deleteInnerItems()},$.RichList.prototype.deleteMainList=function(){this.list.$rootList.find("."+g.deleteClass).first().unbind().click(function(){var a,b=$(this);if(a=window.confirm("Are you sure you want to delete this card & all its children?")){var c=b.parents("."+g.titleItemClass).length?b.parents("."+g.titleItemClass).parent("."+g.listTitle):b.parents("."+g.itemClass);saveState.listsChanged=!0,c.next("."+g.subItemClass).children(g.listNode).find("*").remove(),c.next("."+g.subItemClass).children(g.listNode).remove(),c.next("."+g.subItemClass).remove(),c.find("*").remove(),g.removeMainList(c)}})},$.RichList.prototype.deleteInnerItems=function(){var a=this;this.list.$rootList.find("."+g.deleteClass).not(":first").unbind().click(function(){var b,c=$(this);b=window.confirm("Are you sure you want to delete this card & all its children?"),b&&(f(!0,c),g.domUpdate.call(a))})},$.RichList.prototype.resetItems=function(){var a={floating:null,evTarget:null,underMouse:null};k=$.extend({},k,a)},$.RichList.prototype.floatItem=function(a,b){this.createFloat(a),this.getChildren(a,b),this.appendPlaceholder(a),$(document.body).append(k.floating)},$.RichList.prototype.createFloat=function(a){k.floating=$(document.createElement(g.itemNode)).addClass(g.listClass+" "+g.dragClass),k.floating.css("width",a.outerWidth(!0))},$.RichList.prototype.floatItemPosition=function(a){k.floating.css({left:a.pageX-k.floating.outerWidth(!0)+25,top:a.pageY-25})},$.RichList.prototype.getChildren=function(a,b){a.next().is("."+g.subItemClass)?(a.next().children("."+g.openClass).removeClass(g.openClass),a.children("."+g.triggerClass).removeClass(g.triggerRotClass),a.children("."+g.triggerClass).collapse(a.parentsUntil(!0)),k.floating.contents=a.next(),this.removeEmptyParentList(b)):k.floating.contents=!1},$.RichList.prototype.removeEmptyParentList=function(a){var b=a.prev("."+g.listTitle);b.length&&!a.children(g.itemNode).length&&(b.children("."+g.triggerClass).remove(),b.removeClass(g.listTitle),a.remove())},$.RichList.prototype.appendPlaceholder=function(a){k.placeholder.css("height",a.outerHeight()),a.after(k.placeholder),a.remove(),k.floating.append(a)},$.RichList.prototype.buildSublist=function(a,b){return a.children("."+g.itemContentClass).after(g.openTriggerMarkup),b?(a.append(g.subListMarkupMain),a.addClass(g.listTitle),a.children("."+g.titleItemClass).children(".buttons-title").after(function(){return g.mainTriggerMarkup}),a.find("."+g.triggerMainClass).addClass(g.triggerRotClass),a.children(g.listNode)):(a.after(g.subListMarkup),a.addClass(g.listTitle),a.next())},$.RichList.prototype.openList=function(a,b,c){b.hasClass(g.openClass)||(c?(a.expandTitle(),b.children("."+g.subAccordionClass).addClass(g.openClass),a.children("."+g.titleItemClass).find("."+g.triggerClass).addClass(g.triggerRotClass)):(a.expand(),b.children("."+g.subAccordionClass).addClass(g.openClass),a.children("."+g.triggerClass).addClass(g.triggerRotClass)))},$.RichList.prototype.addItem=function(a,b,d){b.length?(this.openList(a,b,d),b.prepend(g.newItemMarkup)):(b=this.buildSublist(a,d),this.list.$triggers.off(),this.list.$triggers=this.list.$rootList.find("."+g.triggerClass),this.initInnerTriggers(),this.initFirstTrigger(),this.list.$triggers.animLocalArrows(),this.openList(a,b,d),d?b.prepend(g.newItemMarkup):b.children("."+g.subAccordionClass).prepend(g.newItemMarkup)),c(),this.deleteItemListener(),this.addItemListener(),this.handleListeners(),b.find(".rfl-list-content:first").trigger("click"),g.domUpdate.call(this)},$.RichList.prototype.dragStart=function(a,b){var c=$(a.target),d=c.closest("."+g.triggerItemClass);k.evTarget=c.closest("."+g.itemClass),j.lastX=a.pageX,j.lastY=a.pageY,this.floatItem(k.evTarget,d),this.floatItemPosition(a),g.stateUpdate(),this.list.$triggers.off(),g.domUpdate.call(this)},$.RichList.prototype.dragStop=function(a,b){var d=k.floating.children(g.itemNode).first(),e=($(this.list.$rootList[0]).children("."+g.mainAccordionClass),this.list.$rootList.data("list-number")),f=k.placeholder.parents("li[data-list-number]").data("list-number"),i=h.data("list"+f);k.placeholder.replaceWith(d),k.floating.contents&&d.after(k.floating.contents),k.floating.remove(),c(),h.delAllEmptyListsTrigs(),this.resetItems(),this.resetMouse(),this.list.$triggers.animLocalArrows(),this.initInnerTriggers(),this.initFirstTrigger(),this.newListListeners(e,f,d),this.handleListeners(),this.deleteItemListener(),this.addItemListener(),this.deleteItemListener.call(i),this.addItemListener.call(i),g.domUpdate.call(this),g.domUpdate.call(i)},$.RichList.prototype.dragMove=function(a,b){var c,d=$(this.list.$rootList[0]).children("."+g.mainAccordionClass),e=k.placeholder.parents("li[data-list-number]").data("list-number");this.floatItemPosition(a),this.deleteEmptyListsTriggers(d),this.mousePositionCalc(a),c=this.mouseNewAx(),this.mouseDistMoved(c),this.itemUnderCursor(a),this.moveHorizontal(),this.moveVertical(a),g.domUpdate.call(this),g.domUpdate.call(h.data("list"+e))},$.RichList.prototype.resetMouse=function(){j={lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.list.$triggers=this.list.$rootList.find("."+g.triggerClass)},$.RichList.prototype.mousePositionCalc=function(a){j.lastX=j.nowX,j.lastY=j.nowY,j.nowX=a.pageX,j.nowY=a.pageY,j.distX=j.nowX-j.lastX,j.distY=j.nowY-j.lastY,j.lastDirX=j.dirX,j.lastDirY=j.dirY,j.dirX=0===j.distX?0:j.distX>0?1:-1,j.dirY=0===j.distY?0:j.distY>0?1:-1},$.RichList.prototype.mouseNewAx=function(){return Math.abs(j.distX)>Math.abs(j.distY)?1:0},$.RichList.prototype.mouseDistMoved=function(a){j.dirAx!==a?(j.distAxX=0,j.distAxY=0):(j.distAxX+=Math.abs(j.distX),0!==j.dirX&&j.dirX!==j.lastDirX&&(j.distAxX=0),j.distAxY+=Math.abs(j.distY),0!==j.dirY&&j.dirY!==j.lastDirY&&(j.distAxY=0)),j.dirAx=a},$.RichList.prototype.itemUnderCursor=function(a){if(k.underMouse=$(document.elementFromPoint(a.pageX-document.body.scrollLeft,a.pageY-(window.pageYOffset||document.documentElement.scrollTop))),k.underMouse.hasClass(g.placeClass))return void(k.underMouse=!1);if(k.underMouse.hasClass(g.itemClass)&&k.underMouse.hasClass(g.subItemClass))this.checkPrev();else{var b=k.underMouse.closest("."+g.itemClass+", ."+g.subItemClass);b.length?(k.underMouse=b,this.checkPrev()):k.underMouse=!1}},$.RichList.prototype.checkPrev=function(){k.underMouse.hasClass(g.subItemClass)&&k.underMouse.children("."+g.subAccordionClass).hasClass(g.openClass)?k.underMouse=k.underMouse.find("."+g.itemClass+":first"):k.underMouse.hasClass(g.subItemClass)&&(k.underMouse=k.underMouse.prev("."+g.itemClass))},$.RichList.prototype.moveVertical=function(a){if(!j.dirAx&&k.underMouse&&k.underMouse.length){var b=a.pageY<k.underMouse.offset().top+k.underMouse.height()/2,c=k.underMouse.hasClass(g.listTitle);!c&&b?k.underMouse.before(k.placeholder):c||b?c&&b?k.underMouse.before(k.placeholder):c&&!b&&k.underMouse.next("."+g.subItemClass).after(k.placeholder):k.underMouse.after(k.placeholder)}},$.RichList.prototype.moveHorizontal=function(){if(j.dirAx&&j.distAxX>=35){var a=k.placeholder.prevAll("."+g.itemClass+":first");if(j.distAxX=0,a.hasClass(g.listTitle)&&!a.next("."+g.subItemClass).children("."+g.subAccordionClass).hasClass(g.openClass))a.expand(!0),a.next("."+g.subItemClass).children("."+g.subAccordionClass).prepend(k.placeholder),a.children("."+g.triggerClass).addClass("fa-rotate-90"),a.next("."+g.subItemClass).children("."+g.subAccordionClass).addClass(g.openClass);else if(a.hasClass(g.listTitle)&&a.next("."+g.subItemClass).children("."+g.subAccordionClass).hasClass(g.openClass))a.next("."+g.subItemClass).children("."+g.subAccordionClass).prepend(k.placeholder),a.children("."+g.triggerClass).addClass("fa-rotate-90"),a.next("."+g.subItemClass).children("."+g.subAccordionClass).addClass(g.openClass);else if(a&&!a.hasClass(g.listTitle)){var b=g.subListMarkup;a.addClass(g.listTitle),a.append(g.openTriggerMarkup),a.after(b),a.next("."+g.subItemClass).children("."+g.subAccordionClass).prepend(k.placeholder)}}},$.RichList.prototype.initFirstTrigger=function(){this.list.$triggers.first().bind("click",function(){var a=$(this).closest("."+g.triggerItemClass),b=a.children("."+g.subAccordionClass);b.hasClass(g.openClass)?$(this).doCollapse(b):$(this).doExpand(b)})},$.RichList.prototype.initInnerTriggers=function(){this.list.$triggers.not(":first").bind("click",function(){var a=$(this).closest("."+g.itemClass),b=a.next("."+g.subItemClass).children("."+g.subAccordionClass);b.hasClass(g.openClass)?$(this).doCollapse(b):$(this).doExpand(b)})},$.RichList.prototype.deleteEmptyListsTriggers=function(a){var b=a.find("."+g.listTitle);b.each(function(){var a=$(this).next("."+g.subItemClass).children(g.listNode);a.each(function(){if(!$(this).children().length){var a=$(this).parent("."+g.subItemClass).prev("."+g.listTitle);a.children().remove("."+g.triggerClass),a.removeClass(g.listTitle),$(this).parent("."+g.subItemClass).remove(),$(this).remove()}})})}}();